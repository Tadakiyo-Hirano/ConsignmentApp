<% provide(:title, "#{customer_name} / #{product_name}") %>
<%= code(@user) %><%= @user.name %>

<h2>委託在庫受払 一覧</h2>
<div class="container">
  <div class="col col-md-8 offset-md-2 user-menu">
    <table class="table-responsive table-bordered table-condensed bg-light">
      <tbody>
        <tr>
          <th><%= Consignment.human_attribute_name :customer_name %></th>
          <td><%= customer_name %></td>
        </tr>
        <tr>
          <th><%= Consignment.human_attribute_name :product_name %></th>
          <td><%= product_name %></td>
        </tr>
        <tr>
            <th><%= Consignment.human_attribute_name :serial_number %></th>
            <td colspan="3"><%= @user.consignments.find(params[:consignment_id]).serial_number %></td>
          </tr>
          <tr>
            <th><%= Consignment.human_attribute_name :note %></th>
            <td colspan="3"><%= @user.consignments.find(params[:consignment_id]).note %></td>
          </tr>
          <tr>
            <th>委託残数</th>
            <td><%= consignment_remaining_count %></td>
          </tr>
      </tbody>
    </table>
    <%= link_to "受払入力", new_user_consignment_stock_path, class: "btn btn-default btn-block" %>
    
    <br>
    
    <table class="table-responsive table-bordered table-condensed table-hover bg-light">
      <% if @stocks.present? %>
        <thead>
          <tr>
            <th>編集</th>
            <th><%= Stock.human_attribute_name :processing_date %></th>
            <th><%= Stock.human_attribute_name :return_quantity %></th>
            <th><%= Stock.human_attribute_name :sales_quantity %></th>
            <th>削除</th>
          </tr>
        </thead>
      <% end %>
      <tbody>
        <% @stocks.decorate.each do |stock| %>
          <tr>
            <td><%= link_to "", edit_user_consignment_stock_path(User.find(params[:user_id]), Consignment.find(params[:consignment_id]), stock), class: "far fa-edit" %></td>
            <td><%= stock.processing_date %><a class=<%= stamp(stock.created_at, stock.updated_at) %>></a></td>
            <td><%= stock.return_quantity %></td>
            <td><%= stock.sales_quantity %></td>
            <td><%= link_to "", user_consignment_stock_path(User.find(params[:user_id]), Consignment.find(params[:consignment_id]), stock), method: :delete,
                                data: { confirm: "#{stock.processing_date}の在庫受払データを削除しますか？" }, class: "fas fa-trash-alt" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <%= link_to "戻る", @user, class: "btn btn-secondary btn-block btn-stock" %>
  </div>
</div>
