<% provide(:title, "商品別委託情報") %>

<h3>商品別委託</h3>
<div class="container">
  <div class="col col-md-12 user-menu">
    <div class="search-link-form">
      <% unless admin_signed_in? %>
        <div class="search-link">
          <%= link_to "#{@user.name}", @user, class: "btn btn-outline-primary" %>
        </div>
      <% end %>
      <div class="search-link">
        <%= link_to "得意先別", by_customer_user_consignments_path(@user), class: "btn btn-outline-primary" %>
      </div>
      <div class="search-link">
        <p class="pc-display">
          <%= link_to "PDF", documents_user_consignments_path(text: "products_pdf", format: "pdf"), :target=>["_blank"], class: "btn btn-danger" %>
        </p>
      </div>
      <div class="search-link">
        <%= form_with(scope: :search, url: by_product_user_consignments_path(@user), class: "form-inline", method: :get, local: true) do |f| %>
          <div class="input-group mb-3">
            <%= f.text_field :product_name, placeholder: "#{Product.human_attribute_name :name}", class: "form-control" %>
            <div class="input-group-append">
              <%= f.submit "検索", class: "btn btn-sm btn-primary" %>
            </div>
          </div>
          <div class="ml-3 mb-3">
            <%= by_product_search_results_text(@consignments) %>&emsp;<%= by_product_search_results_link(by_product_user_consignments_path(@user)) %>
          </div>
        <% end %>
      </div>
    </div>
    
    <% @consignments.each do |product_id_number, consignments| %>
      <table class="table every default table-responsive table-bordered table-condensed bg-light">
        <thead>
          <tr>
            <th colspan="4" class="every">【<%= Product.find(product_id_number).code %>】<%= Product.find(product_id_number).name %></th>
          </tr>
        </thead>
        
        <tbody>
          <tr>
            <th width="15%" class="pc-display"><%= Customer.human_attribute_name :code %></th>
            <th width="45%"><%= Customer.human_attribute_name :name %></th>
            <th width="10%" class="pc-display">委託残</th>
            <th width="10%" class="mobile-display">残</th>
            <th width="230">担当者</th>
          </tr>
          <% consignments.each do |consignment| %>
            <tr>
              <td class="pc-display"><%= Customer.find(consignment.customer_id_number).code %></td>
              <td><%= Customer.find(consignment.customer_id_number).name %></td>
              <td class="<%= total_consignment_balance_color(consignment) %>">
                <%= total_consignment_balance(consignment) %>
              </td>
              <td><%= User.find(consignment.user_id).name %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <br>
    <% end %>
  </div>
</div>