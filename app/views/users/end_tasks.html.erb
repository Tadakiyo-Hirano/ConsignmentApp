<% provide(:title, @user.name) %>

<h1>処理済</h1>
<h4><%= @user.name %></h4>
<div class="container">
  <div class="col col-md-12 user-menu">
    <div class="search-link-form">
      <div class="search-link">
        <%= link_to "戻る", @user, class: "btn btn-secondary" %>
      </div>
      <div class="search-link">
        <%= form_with(scope: :search, url: end_tasks_user_path(@user), class: "form-inline", method: :get, local: true) do |f| %>
          <div class="input-group mb-3">
            <%= f.text_field :customer_name, placeholder: "#{Customer.human_attribute_name :name}", class: "form-control" %>
            <%= f.text_field :product_name, placeholder: "#{Product.human_attribute_name :name}", class: "form-control" %>
            <div class="input-group-append">
              <%= f.submit "検索", class: "btn btn-sm btn-default" %>
            </div>
          </div>
          <div class="ml-3 mb-3">
            <%= consignment_search_results_text(@user_consignments) %>&emsp;<%= consignment_search_results_link(end_tasks_user_path(@user)) %>
          </div>
        <% end %>
      </div>
    </div>

    <%= paginate @user_consignments if @search_none %>
    <table class="table-responsive table-bordered table-condensed table-hover bg-light" id="table-products">
      <thead>
        <tr>
          <th>編集</th>
          <th><%= Consignment.human_attribute_name :ship_date %></th>
          <th class="pc-display"><%= Product.human_attribute_name :code %></th>
          <th><%= Product.human_attribute_name :name %></th>
          <th><%= Consignment.human_attribute_name :quantity %></th>
          <th class="pc-display"><%= Consignment.human_attribute_name :serial_number %></th>
          <th class="pc-display"><%= Consignment.human_attribute_name :customer_code %></th>
          <th class="pc-display"><%= Consignment.human_attribute_name :customer_name %></th>
          <th class="pc-display"><%= Consignment.human_attribute_name :note %></th>
        </tr>
      </thead>
      
      <% @user_consignments.decorate.each do |c| %>
        <tbody>
          <!--< if none_zero_total(c) %> <!-- 委託残数0は表示しない。 -->
            <tr>
              <td><%= link_to "", user_consignment_path(@user, c), class: "far fa-edit" %></td>
              <td class="pc-display"><%= l(c.ship_date, format: :default) %><a class=<%= stamp(c.created_at, c.updated_at) %>></a></td>
              <td class="mobile-display"><%= l(c.ship_date, format: :short) %><a class=<%= stamp(c.created_at, c.updated_at) %>></a></td>
              <td class="pc-display"><%= c.product_id_num&.code %></td>
              <td><%= c.product_id_num&.name %></td>
              <td>
                <%= link_to total_consignment_balance(c), user_consignment_stocks_path(@user, c), class: "#{total_consignment_balance_color(c)}" %>
              </td>
              <td class="pc-display"><%= c.serial_number %></td>
              <td class="pc-display"><%= c.customer_id_num&.code %></td>
              <td class="pc-display"><%= c.customer_id_num&.name %></td>
              <td class="pc-display"><%= c.note %>(<%= c.done %>)</td>
            </tr>
          <!--< end %>-->
        </tbody>
      <% end %>
    </table>
  </div>
</div>